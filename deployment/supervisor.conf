# FastJob Supervisor Configuration
# Place this file in /etc/supervisor/conf.d/fastjob.conf

[group:fastjob]
programs=fastjob_worker,fastjob_dashboard

[program:fastjob_worker]
command=/opt/fastjob/venv/bin/fastjob worker --concurrency=4 --queues=default,urgent,background
directory=/opt/fastjob
user=fastjob
autostart=true
autorestart=true
startretries=3
redirect_stderr=true
stdout_logfile=/var/log/fastjob/worker.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5
environment=FASTJOB_DATABASE_URL="postgresql://fastjob:password@localhost/fastjob_prod",FASTJOB_LOG_LEVEL="INFO"

[program:fastjob_dashboard]
command=/opt/fastjob/venv/bin/fastjob dashboard --host=0.0.0.0 --port=8000
directory=/opt/fastjob
user=fastjob
autostart=true
autorestart=true
startretries=3
redirect_stderr=true
stdout_logfile=/var/log/fastjob/dashboard.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5
environment=FASTJOB_DATABASE_URL="postgresql://fastjob:password@localhost/fastjob_prod",FASTJOB_LOG_LEVEL="INFO"

# Optional: Additional worker for high-priority jobs
[program:fastjob_priority_worker]
command=/opt/fastjob/venv/bin/fastjob worker --concurrency=2 --queues=urgent
directory=/opt/fastjob
user=fastjob
autostart=true
autorestart=true
startretries=3
redirect_stderr=true
stdout_logfile=/var/log/fastjob/priority_worker.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5
environment=FASTJOB_DATABASE_URL="postgresql://fastjob:password@localhost/fastjob_prod",FASTJOB_LOG_LEVEL="INFO"

# Health check program
[program:fastjob_healthcheck]
command=/opt/fastjob/scripts/health_check.sh
directory=/opt/fastjob
user=fastjob
autostart=false
autorestart=false